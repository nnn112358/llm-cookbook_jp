<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>6. 入力処理-チェーン式プロンプト</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown-min.css" />
</head>
<body>
<h1 id="第6章-入力の処理-チェーン式プロンプト">第6章
入力の処理-チェーン式プロンプト</h1>
<p>チェーン式プロンプトは、複雑なタスクを複数のシンプルなプロンプトに分解する戦略です。この章では、チェーン式プロンプトを使用して複雑なタスクを一連のシンプルなサブタスクに分割する方法を学習します。チェーン・オブ・ソート推論で一度に完了できるなら、なぜタスクを複数のプロンプトに分割する必要があるのかと疑問に思うかもしれません。</p>
<p>主な理由は、チェーン式プロンプトが以下の利点を持つからです：</p>
<ol type="1">
<li><p>複雑さの分解、各プロンプトは具体的なサブタスク1つのみを処理し、過度に広範な要求を避け、成功率を向上させる。これは段階的な料理に似ており、一度にすべてを完了しようとするのではない。</p></li>
<li><p>計算コストの削減。長すぎるプロンプトはより多くのトークンを使用し、コストを増加させる。プロンプトを分割することで不要な計算を避けることができる。</p></li>
<li><p>テストとデバッグがより容易。各段階の性能を段階的に分析できる。</p></li>
<li><p>外部ツールの統合。異なるプロンプトでAPI、データベースなどの外部リソースを呼び出すことができる。</p></li>
<li><p>より柔軟なワークフロー。異なる状況に応じて異なる操作を実行できる。</p></li>
</ol>
<p>総合すると、チェーン式プロンプトは複雑なタスクを科学的に分割することで、より効率的で信頼性の高いプロンプト設計を実現します。言語モデルが単一のサブタスクに集中して処理できるようにし、認知負荷を減らしながら、多段階タスクの能力を保持します。経験の蓄積により、開発者は徐々にチェーン式プロンプト活用の真髄を習得できます。</p>
<h2 id="一製品とカテゴリの抽出">一、製品とカテゴリの抽出</h2>
<p>我々が分解する最初のサブタスクは、LLMにユーザークエリから製品とカテゴリを抽出するよう要求することです。</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tool <span class="im">import</span> get_completion_from_messages</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>delimiter <span class="op">=</span> <span class="st">&quot;####&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>system_message <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ss">カスタマーサービスクエリが提供されます。</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ss">カスタマーサービスクエリは</span><span class="sc">{</span>delimiter<span class="sc">}</span><span class="ss">文字を区切り文字として使用します。</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ss">解析可能なPythonリストのみを出力してください。リストの各要素は以下の形式のJSONオブジェクトです：</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ss">&#39;category&#39;: &lt;以下のカテゴリを含む：Computers and Laptops、Smartphones and Accessories、Televisions and Home Theater Systems、Gaming Consoles and Accessories、Audio Equipment、Cameras and Camcorders&gt;,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ss">および</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ss">&#39;products&#39;: &lt;以下の許可された製品リストで見つかる製品のリストでなければなりません&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ss">カテゴリと製品はカスタマーサービスクエリで見つからなければなりません。</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ss">製品が言及された場合、許可された製品リストの正しいカテゴリと関連付けられなければなりません。</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ss">製品またはカテゴリが見つからない場合は、空のリストを出力してください。</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="ss">リスト以外は何も出力しないでください！</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ss">許可された製品：</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="ss">Computers and Laptops category:</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="ss">TechPro Ultrabook</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="ss">BlueWave Gaming Laptop</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="ss">PowerLite Convertible</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="ss">TechPro Desktop</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="ss">BlueWave Chromebook</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="ss">Smartphones and Accessories category:</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="ss">SmartX ProPhone</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="ss">MobiTech PowerCase</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="ss">SmartX MiniPhone</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="ss">MobiTech Wireless Charger</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="ss">SmartX EarBuds</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="ss">Televisions and Home Theater Systems category:</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="ss">CineView 4K TV</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="ss">SoundMax Home Theater</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="ss">CineView 8K TV</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="ss">SoundMax Soundbar</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="ss">CineView OLED TV</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="ss">Gaming Consoles and Accessories category:</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="ss">GameSphere X</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="ss">ProGamer Controller</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="ss">GameSphere Y</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="ss">ProGamer Racing Wheel</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="ss">GameSphere VR Headset</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="ss">Audio Equipment category:</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="ss">AudioPhonic Noise-Canceling Headphones</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="ss">WaveSound Bluetooth Speaker</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="ss">AudioPhonic True Wireless Earbuds</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="ss">WaveSound Soundbar</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="ss">AudioPhonic Turntable</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="ss">Cameras and Camcorders category:</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="ss">FotoSnap DSLR Camera</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="ss">ActionCam 4K</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="ss">FotoSnap Mirrorless Camera</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="ss">ZoomMaster Camcorder</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="ss">FotoSnap Instant Camera</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="ss">    </span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="ss">オブジェクトのリストのみを出力し、他の内容は含めないでください。</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>user_message_1 <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="ss"> smartx pro phoneとthe fotosnap cameraについて教えてください。</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="ss"> また、テレビの状況についても教えてください。 &quot;&quot;&quot;</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span>  [{<span class="st">&#39;role&#39;</span>:<span class="st">&#39;system&#39;</span>, <span class="st">&#39;content&#39;</span>: system_message},    </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>             {<span class="st">&#39;role&#39;</span>:<span class="st">&#39;user&#39;</span>, <span class="st">&#39;content&#39;</span>: <span class="ss">f&quot;</span><span class="sc">{</span>delimiter<span class="sc">}{</span>user_message_1<span class="sc">}{</span>delimiter<span class="sc">}</span><span class="ss">&quot;</span>}] </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>category_and_product_response_1 <span class="op">=</span> get_completion_from_messages(messages)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(category_and_product_response_1)</span></code></pre></div>
<pre><code>[{&#39;category&#39;: &#39;Smartphones and Accessories&#39;, &#39;products&#39;: [&#39;SmartX ProPhone&#39;]}, {&#39;category&#39;: &#39;Cameras and Camcorders&#39;, &#39;products&#39;: [&#39;FotoSnap DSLR Camera&#39;, &#39;FotoSnap Mirrorless Camera&#39;, &#39;FotoSnap Instant Camera&#39;]}, {&#39;category&#39;: &#39;Televisions and Home Theater Systems&#39;, &#39;products&#39;: [&#39;CineView 4K TV&#39;, &#39;CineView 8K TV&#39;, &#39;CineView OLED TV&#39;, &#39;SoundMax Home Theater&#39;, &#39;SoundMax Soundbar&#39;]}]</code></pre>
<p>出力はオブジェクトのリストで、各オブジェクトにカテゴリといくつかの製品があることがわかります。例えば「SmartX
ProPhone」と「Fotosnap DSLR Camera」、「CineView 4K TV」などです。</p>
<p>もう一つの例を見てみましょう。</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>user_message_2 <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;ルーターが動作しません&quot;&quot;&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span>  [{<span class="st">&#39;role&#39;</span>:<span class="st">&#39;system&#39;</span>,<span class="st">&#39;content&#39;</span>: system_message},</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>             {<span class="st">&#39;role&#39;</span>:<span class="st">&#39;user&#39;</span>,<span class="st">&#39;content&#39;</span>: <span class="ss">f&quot;</span><span class="sc">{</span>delimiter<span class="sc">}{</span>user_message_2<span class="sc">}{</span>delimiter<span class="sc">}</span><span class="ss">&quot;</span>}] </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> get_completion_from_messages(messages)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response)</span></code></pre></div>
<pre><code>[]</code></pre>
<h2 id="二詳細情報の検索">二、詳細情報の検索</h2>
<p>例として大量の製品情報を提供し、モデルに製品と対応する詳細情報を抽出するよう要求します。紙面の制約により、製品情報をproducts.jsonに保存しています。</p>
<p>まず、Pythonコードで製品情報を読み取りましょう。</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 製品情報を読み取り</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;products_zh.json&quot;</span>, <span class="st">&quot;r&quot;</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    products <span class="op">=</span> json.load(<span class="bu">file</span>)</span></code></pre></div>
<p>次に、get_product_by_name関数を定義して、製品名に基づいて製品を取得できるようにします：</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_product_by_name(name):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    製品名に基づいて製品を取得</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    パラメータ:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">    name: 製品名</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> products.get(name, <span class="va">None</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_products_by_category(category):</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">    カテゴリに基づいて製品を取得</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">    パラメータ:</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">    category: 製品カテゴリ</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [product <span class="cf">for</span> product <span class="kw">in</span> products.values() <span class="cf">if</span> product[<span class="st">&quot;カテゴリ&quot;</span>] <span class="op">==</span> category]</span></code></pre></div>
<p>get_product_by_name関数を呼び出し、製品名「TechPro
Ultrabook」を入力：</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>get_product_by_name(<span class="st">&quot;TechPro Ultrabook&quot;</span>)</span></code></pre></div>
<pre><code>{&#39;名前&#39;: &#39;TechPro ウルトラブック&#39;,
 &#39;カテゴリ&#39;: &#39;コンピューターとノートパソコン&#39;,
 &#39;ブランド&#39;: &#39;TechPro&#39;,
 &#39;型番&#39;: &#39;TP-UB100&#39;,
 &#39;保証期間&#39;: &#39;1年&#39;,
 &#39;評価&#39;: 4.5,
 &#39;特徴&#39;: [&#39;13.3インチディスプレイ&#39;, &#39;8GB RAM&#39;, &#39;256GB SSD&#39;, &#39;Intel Core i5プロセッサ&#39;],
 &#39;説明&#39;: &#39;スタイリッシュで軽量なウルトラブック、日常使用に適している。&#39;,
 &#39;価格&#39;: 799.99}</code></pre>
<p>次に、もう一つの例を見てみましょう。get_products_by_category関数を呼び出し、製品名「コンピューターとノートパソコン」を入力：</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>get_products_by_category(<span class="st">&quot;コンピューターとノートパソコン&quot;</span>)</span></code></pre></div>
<pre><code>[{&#39;名前&#39;: &#39;TechPro ウルトラブック&#39;,
  &#39;カテゴリ&#39;: &#39;コンピューターとノートパソコン&#39;,
  &#39;ブランド&#39;: &#39;TechPro&#39;,
  &#39;型番&#39;: &#39;TP-UB100&#39;,
  &#39;保証期間&#39;: &#39;1年&#39;,
  &#39;評価&#39;: 4.5,
  &#39;特徴&#39;: [&#39;13.3インチディスプレイ&#39;, &#39;8GB RAM&#39;, &#39;256GB SSD&#39;, &#39;Intel Core i5プロセッサ&#39;],
  &#39;説明&#39;: &#39;スタイリッシュで軽量なウルトラブック、日常使用に適している。&#39;,
  &#39;価格&#39;: 799.99},
 {&#39;名前&#39;: &#39;BlueWave ゲーミングノートパソコン&#39;,
  &#39;カテゴリ&#39;: &#39;コンピューターとノートパソコン&#39;,
  &#39;ブランド&#39;: &#39;BlueWave&#39;,
  &#39;型番&#39;: &#39;BW-GL200&#39;,
  &#39;保証期間&#39;: &#39;2年&#39;,
  &#39;評価&#39;: 4.7,
  &#39;特徴&#39;: [&#39;15.6インチディスプレイ&#39;,
   &#39;16GB RAM&#39;,
   &#39;512GB SSD&#39;,
   &#39;NVIDIA GeForce RTX 3060&#39;],
  &#39;説明&#39;: &#39;没入型体験を提供する高性能ゲーミングノートパソコン。&#39;,
  &#39;価格&#39;: 1199.99},
 {&#39;名前&#39;: &#39;PowerLite コンバーチブル&#39;,
  &#39;カテゴリ&#39;: &#39;コンピューターとノートパソコン&#39;,
  &#39;ブランド&#39;: &#39;PowerLite&#39;,
  &#39;型番&#39;: &#39;PL-CV300&#39;,
  &#39;保証期間&#39;: &#39;1年&#39;,
  &#39;評価&#39;: 4.3,
  &#39;特徴&#39;: [&#39;14インチタッチスクリーン&#39;, &#39;8GB RAM&#39;, &#39;256GB SSD&#39;, &#39;360度ヒンジ&#39;],
  &#39;説明&#39;: &#39;レスポンシブなタッチスクリーンを備えた多機能コンバーチブルノートパソコン。&#39;,
  &#39;価格&#39;: 699.99},
 {&#39;名前&#39;: &#39;TechPro デスクトップ&#39;,
  &#39;カテゴリ&#39;: &#39;コンピューターとノートパソコン&#39;,
  &#39;ブランド&#39;: &#39;TechPro&#39;,
  &#39;型番&#39;: &#39;TP-DT500&#39;,
  &#39;保証期間&#39;: &#39;1年&#39;,
  &#39;評価&#39;: 4.4,
  &#39;特徴&#39;: [&#39;Intel Core i7プロセッサ&#39;,
   &#39;16GB RAM&#39;,
   &#39;1TB HDD&#39;,
   &#39;NVIDIA GeForce GTX 1660&#39;],
  &#39;説明&#39;: &#39;仕事と娯楽に適した強力なデスクトップコンピューター。&#39;,
  &#39;価格&#39;: 999.99},
 {&#39;名前&#39;: &#39;BlueWave Chromebook&#39;,
  &#39;カテゴリ&#39;: &#39;コンピューターとノートパソコン&#39;,
  &#39;ブランド&#39;: &#39;BlueWave&#39;,
  &#39;型番&#39;: &#39;BW-CB100&#39;,
  &#39;保証期間&#39;: &#39;1年&#39;,
  &#39;評価&#39;: 4.1,
  &#39;特徴&#39;: [&#39;11.6インチディスプレイ&#39;, &#39;4GB RAM&#39;, &#39;32GB eMMC&#39;, &#39;Chrome OS&#39;],
  &#39;説明&#39;: &#39;日常的なタスクに適したコンパクトで手頃な価格のChromebook。&#39;,
  &#39;価格&#39;: 249.99}]</code></pre>
<h2 id="三クエリ回答の生成">三、クエリ回答の生成</h2>
<h3 id="入力文字列の解析">3.1 入力文字列の解析</h3>
<p>read_string_to_list関数を定義して、入力文字列をPythonリストに変換します</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_string_to_list(input_string):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">    入力文字列をPythonリストに変換します。</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">    パラメータ:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">    input_string: 入力文字列、有効なJSON形式である必要があります。</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">    戻り値:</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">    list または None: 入力文字列が有効な場合は対応するPythonリストを返し、そうでなければNoneを返します。</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> input_string <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 入力文字列の単引用符を二重引用符に置き換えて、JSON形式の要件を満たす</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        input_string <span class="op">=</span> input_string.replace(<span class="st">&quot;&#39;&quot;</span>, <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&quot;</span>)  </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(input_string)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Error: Invalid JSON string&quot;</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>   </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>category_and_product_list <span class="op">=</span> read_string_to_list(category_and_product_response_1)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(category_and_product_list)</span></code></pre></div>
<pre><code>[{&#39;category&#39;: &#39;Smartphones and Accessories&#39;, &#39;products&#39;: [&#39;SmartX ProPhone&#39;]}, {&#39;category&#39;: &#39;Cameras and Camcorders&#39;, &#39;products&#39;: [&#39;FotoSnap DSLR Camera&#39;, &#39;FotoSnap Mirrorless Camera&#39;, &#39;FotoSnap Instant Camera&#39;]}, {&#39;category&#39;: &#39;Televisions and Home Theater Systems&#39;, &#39;products&#39;: [&#39;CineView 4K TV&#39;, &#39;CineView 8K TV&#39;, &#39;CineView OLED TV&#39;, &#39;SoundMax Home Theater&#39;, &#39;SoundMax Soundbar&#39;]}]</code></pre>
<h3 id="検索の実行">3.2 検索の実行</h3>
<p>generate_output_string関数を定義して、入力データリストに基づいて製品またはカテゴリ情報を含む文字列を生成します：</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_output_string(data_list):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">    入力データリストに基づいて製品またはカテゴリ情報を含む文字列を生成します。</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">    パラメータ:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    data_list: 辞書を含むリスト、各辞書は「products」または「category」のキーを含む必要があります。</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">    戻り値:</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">    output_string: 製品またはカテゴリ情報を含む文字列。</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    output_string <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data_list <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> output_string</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> data <span class="kw">in</span> data_list:</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&quot;products&quot;</span> <span class="kw">in</span> data <span class="kw">and</span> data[<span class="st">&quot;products&quot;</span>]:</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                products_list <span class="op">=</span> data[<span class="st">&quot;products&quot;</span>]</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> product_name <span class="kw">in</span> products_list:</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                    product <span class="op">=</span> get_product_by_name(product_name)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> product:</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                        output_string <span class="op">+=</span> json.dumps(product, indent<span class="op">=</span><span class="dv">4</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>) <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f&quot;Error: Product &#39;</span><span class="sc">{</span>product_name<span class="sc">}</span><span class="ss">&#39; not found&quot;</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="st">&quot;category&quot;</span> <span class="kw">in</span> data:</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                category_name <span class="op">=</span> data[<span class="st">&quot;category&quot;</span>]</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                category_products <span class="op">=</span> get_products_by_category(category_name)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> product <span class="kw">in</span> category_products:</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>                    output_string <span class="op">+=</span> json.dumps(product, indent<span class="op">=</span><span class="dv">4</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>) <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&quot;Error: Invalid object format&quot;</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_string </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>product_information_for_user_message_1 <span class="op">=</span> generate_output_string(category_and_product_list)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(product_information_for_user_message_1)</span></code></pre></div>
<pre><code>{
    &quot;名前&quot;: &quot;SmartX ProPhone&quot;,
    &quot;カテゴリ&quot;: &quot;スマートフォンとアクセサリー&quot;,
    &quot;ブランド&quot;: &quot;SmartX&quot;,
    &quot;型番&quot;: &quot;SX-PP10&quot;,
    &quot;保証期間&quot;: &quot;1年&quot;,
    &quot;評価&quot;: 4.6,
    &quot;特徴&quot;: [
        &quot;6.1インチディスプレイ&quot;,
        &quot;128GBストレージ&quot;,
        &quot;12MP デュアルカメラ&quot;,
        &quot;5G&quot;
    ],
    &quot;説明&quot;: &quot;先進的なカメラ機能を持つ強力なスマートフォン。&quot;,
    &quot;価格&quot;: 899.99
}
{
    &quot;名前&quot;: &quot;FotoSnap DSLR Camera&quot;,
    &quot;カテゴリ&quot;: &quot;カメラとビデオカメラ&quot;,
    &quot;ブランド&quot;: &quot;FotoSnap&quot;,
    &quot;型番&quot;: &quot;FS-DSLR200&quot;,
    &quot;保証期間&quot;: &quot;1年&quot;,
    &quot;評価&quot;: 4.7,
    &quot;特徴&quot;: [
        &quot;24.2MPセンサー&quot;,
        &quot;1080pビデオ&quot;,
        &quot;3インチLCD&quot;,
        &quot;交換可能レンズ&quot;
    ],
    &quot;説明&quot;: &quot;この多機能一眼レフカメラで驚くべき写真とビデオを撮影。&quot;,
    &quot;価格&quot;: 599.99
}
{
    &quot;名前&quot;: &quot;FotoSnap ミラーレスカメラ&quot;,
    &quot;カテゴリ&quot;: &quot;カメラとビデオカメラ&quot;,
    &quot;ブランド&quot;: &quot;FotoSnap&quot;,
    &quot;型番&quot;: &quot;FS-ML100&quot;,
    &quot;保証期間&quot;: &quot;1年&quot;,
    &quot;評価&quot;: 4.6,
    &quot;特徴&quot;: [
        &quot;20.1MPセンサー&quot;,
        &quot;4Kビデオ&quot;,
        &quot;3インチタッチスクリーン&quot;,
        &quot;交換可能レンズ&quot;
    ],
    &quot;説明&quot;: &quot;先進機能を備えたコンパクトで軽量なミラーレスカメラ。&quot;,
    &quot;価格&quot;: 799.99
}
{
    &quot;名前&quot;: &quot;FotoSnap インスタントカメラ&quot;,
    &quot;カテゴリ&quot;: &quot;カメラとビデオカメラ&quot;,
    &quot;ブランド&quot;: &quot;FotoSnap&quot;,
    &quot;型番&quot;: &quot;FS-IC10&quot;,
    &quot;保証期間&quot;: &quot;1年&quot;,
    &quot;評価&quot;: 4.1,
    &quot;特徴&quot;: [
        &quot;インスタントプリント&quot;,
        &quot;内蔵フラッシュ&quot;,
        &quot;セルフィーミラー&quot;,
        &quot;バッテリー駆動&quot;
    ],
    &quot;説明&quot;: &quot;この楽しくてポータブルなインスタントカメラで瞬間の思い出を作成。&quot;,
    &quot;価格&quot;: 69.99
}
{
    &quot;名前&quot;: &quot;CineView 4K TV&quot;,
    &quot;カテゴリ&quot;: &quot;テレビとホームシアターシステム&quot;,
    &quot;ブランド&quot;: &quot;CineView&quot;,
    &quot;型番&quot;: &quot;CV-4K55&quot;,
    &quot;保証期間&quot;: &quot;2年&quot;,
    &quot;評価&quot;: 4.8,
    &quot;特徴&quot;: [
        &quot;55インチディスプレイ&quot;,
        &quot;4K解像度&quot;,
        &quot;HDR&quot;,
        &quot;スマートTV&quot;
    ],
    &quot;説明&quot;: &quot;鮮やかな色彩とスマート機能が豊富な驚くべき4KTV。&quot;,
    &quot;価格&quot;: 599.99
}
{
    &quot;名前&quot;: &quot;CineView 8K TV&quot;,
    &quot;カテゴリ&quot;: &quot;テレビとホームシアターシステム&quot;,
    &quot;ブランド&quot;: &quot;CineView&quot;,
    &quot;型番&quot;: &quot;CV-8K65&quot;,
    &quot;保証期間&quot;: &quot;2年&quot;,
    &quot;評価&quot;: 4.9,
    &quot;特徴&quot;: [
        &quot;65インチディスプレイ&quot;,
        &quot;8K解像度&quot;,
        &quot;HDR&quot;,
        &quot;スマートTV&quot;
    ],
    &quot;説明&quot;: &quot;この驚くべき8KTVでテレビの未来を体験。&quot;,
    &quot;価格&quot;: 2999.99
}
{
    &quot;名前&quot;: &quot;CineView OLED TV&quot;,
    &quot;カテゴリ&quot;: &quot;テレビとホームシアターシステム&quot;,
    &quot;ブランド&quot;: &quot;CineView&quot;,
    &quot;型番&quot;: &quot;CV-OLED55&quot;,
    &quot;保証期間&quot;: &quot;2年&quot;,
    &quot;評価&quot;: 4.7,
    &quot;特徴&quot;: [
        &quot;55インチディスプレイ&quot;,
        &quot;4K解像度&quot;,
        &quot;HDR&quot;,
        &quot;スマートTV&quot;
    ],
    &quot;説明&quot;: &quot;このOLED TVで真のカラフルな体験を。&quot;,
    &quot;価格&quot;: 1499.99
}
{
    &quot;名前&quot;: &quot;SoundMax ホームシアター&quot;,
    &quot;カテゴリ&quot;: &quot;テレビとホームシアターシステム&quot;,
    &quot;ブランド&quot;: &quot;SoundMax&quot;,
    &quot;型番&quot;: &quot;SM-HT100&quot;,
    &quot;保証期間&quot;: &quot;1年&quot;,
    &quot;評価&quot;: 4.4,
    &quot;特徴&quot;: [
        &quot;5.1チャンネル&quot;,
        &quot;1000W出力&quot;,
        &quot;ワイヤレスサブウーファー&quot;,
        &quot;Bluetooth&quot;
    ],
    &quot;説明&quot;: &quot;没入型オーディオ体験を提供する強力なホームシアターシステム。&quot;,
    &quot;価格&quot;: 399.99
}
{
    &quot;名前&quot;: &quot;SoundMax サウンドバー&quot;,
    &quot;カテゴリ&quot;: &quot;テレビとホームシアターシステム&quot;,
    &quot;ブランド&quot;: &quot;SoundMax&quot;,
    &quot;型番&quot;: &quot;SM-SB50&quot;,
    &quot;保証期間&quot;: &quot;1年&quot;,
    &quot;評価&quot;: 4.3,
    &quot;特徴&quot;: [
        &quot;2.1チャンネル&quot;,
        &quot;300W出力&quot;,
        &quot;ワイヤレスサブウーファー&quot;,
        &quot;Bluetooth&quot;
    ],
    &quot;説明&quot;: &quot;このスタイリッシュで強力なサウンドでテレビのオーディオ体験をアップグレード。&quot;,
    &quot;価格&quot;: 199.99
}</code></pre>
<h3 id="ユーザークエリの回答生成">3.3 ユーザークエリの回答生成</h3>
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>system_message <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ss">あなたは大規模電子店舗のカスタマーサービスアシスタントです。</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ss">フレンドリーで役立つ口調で質問に答え、できるだけ簡潔明瞭にしてください。</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ss">ユーザーに関連するフォローアップ質問をするようにしてください。</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>user_message_1 <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ss">smartx pro phoneとthe fotosnap cameraについて教えてください。</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ss">また、テレビの状況についても教えてください。</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span>  [{<span class="st">&#39;role&#39;</span>:<span class="st">&#39;system&#39;</span>,<span class="st">&#39;content&#39;</span>: system_message},</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>             {<span class="st">&#39;role&#39;</span>:<span class="st">&#39;user&#39;</span>,<span class="st">&#39;content&#39;</span>: user_message_1},  </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>             {<span class="st">&#39;role&#39;</span>:<span class="st">&#39;assistant&#39;</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;content&#39;</span>: <span class="ss">f&quot;&quot;&quot;関連製品情報:</span><span class="ch">\n\</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="ss">              </span><span class="sc">{</span>product_information_for_user_message_1<span class="sc">}</span><span class="ss">&quot;&quot;&quot;</span>}]</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>final_response <span class="op">=</span> get_completion_from_messages(messages)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(final_response)</span></code></pre></div>
<pre><code>SmartX ProPhoneとFotoSnapカメラに関する情報は以下の通りです：

SmartX ProPhoneは、SmartXブランドのスマートフォンです。6.1インチディスプレイ、128GBストレージ、12MPデュアルカメラ、5Gネットワークサポートを備えています。このスマートフォンの特徴は先進的なカメラ機能です。価格は899.99ドルです。

FotoSnapカメラには複数のモデルがあります。DSLR カメラ、ミラーレスカメラ、インスタントカメラが含まれます。DSLRカメラは24.2MPセンサー、1080pビデオ撮影、3インチLCDスクリーン、交換可能レンズを備えています。ミラーレスカメラは20.1MPセンサー、4Kビデオ撮影、3インチタッチスクリーン、交換可能レンズを備えています。インスタントカメラはインスタントプリント機能、内蔵フラッシュ、セルフィーミラー、バッテリー駆動を備えています。これらのカメラの価格はそれぞれ599.99ドル、799.99ドル、69.99ドルです。

テレビ製品については、CineViewとSoundMaxブランドのテレビとホームシアターシステムをご用意しています。CineView テレビには4K解像度と8K解像度のテレビ、およびOLED TVを含む異なるモデルがあります。これらのテレビはすべてHDRとスマートTV機能を備えています。価格は599.99ドルから2999.99ドルまでです。SoundMaxブランドはホームシアターシステムとサウンドバーを提供しています。ホームシアターシステムは5.1チャンネル、1000W出力、ワイヤレスサブウーファー、Bluetooth機能を備え、価格は399.99ドルです。サウンドバーは2.1チャンネル、300W出力、ワイヤレスサブウーファー、Bluetooth機能を備え、価格は199.99ドルです。

上記の製品の中で特にどれにご興味がおありでしょうか？</code></pre>
<p>この例では、製品名による製品説明の取得またはカテゴリ名によるカテゴリ製品の取得という特定の関数または関数の呼び出しのみを追加しました。しかし、モデルは実際に様々な異なるツールをいつ使用するかを決定するのが得意で、正しく使用することができます。これがChatGPTプラグインの背景にある考え方です。モデルにアクセス可能なツールとその機能を伝えることで、特定のソースから情報を取得する必要があるとき、または他の適切なアクションを取りたいときに、それらを使用することを選択します。この例では、正確な製品とカテゴリ名のマッチングによってのみ情報を検索できますが、より高度な情報検索技術もあります。情報を検索する最も効果的な方法の一つは、命名実体認識や関係抽出などの自然言語処理技術を使用することです。</p>
<p>もう一つの方法は、テキスト埋め込み（Embedding）を使用して情報を取得することです。埋め込みは大規模コーパスに対する効率的な知識検索を実装して、与えられたクエリに関連する情報を見つけるために使用できます。テキスト埋め込みを使用する主要な利点は、あいまい検索や意味検索を実装できることで、正確なキーワードを使用せずに関連情報を見つけることができることです。したがって、この例では、製品の正確な名前は必要なく、<strong>「スマートフォン」</strong>のようなより一般的なクエリを使用して検索できます。</p>
<h2 id="四まとめ">四、まとめ</h2>
<p>プロンプトチェーンを設計する際、すべての可能性のある関連情報を一度にモデルに読み込む必要も推奨もしません。代わりに、動的で必要に応じて情報を提供する戦略を採用します。理由は以下の通りです：</p>
<ol type="1">
<li><p>過度に無関係な情報は、モデルがコンテキストを処理する際により混乱させます。特に低レベルのモデルでは、大量のデータを処理すると性能が劣化します。</p></li>
<li><p>モデル自体がコンテキスト長に制限があり、一度に過度の情報を読み込むことができません。</p></li>
<li><p>過度の情報を含むことは過学習を引き起こしやすく、新しいクエリを処理する際の効果が劣ります。</p></li>
<li><p>動的な情報読み込みは計算コストを削減できます。</p></li>
<li><p>モデルがより多くの情報が必要な時を主体的に決定できるようにすることで、その推論能力を強化できます。</p></li>
<li><p>正確なマッチングだけでなく、より賢い検索メカニズムを使用できます。例えば、テキストEmbeddingによる意味検索の実装です。</p></li>
</ol>
<p>したがって、プロンプトチェーンの情報提供戦略を合理的に設計し、モデルの能力制限を考慮しながら、その主体的学習能力の向上も兼ね備えることは、プロンプトエンジニアリングで重点的に考慮すべき点です。これらの経験が皆さんが効率的で賢いプロンプトチェーンシステムを設計するのに役立つことを願っています。</p>
<p>次の章では、言語モデルの出力を評価する方法について議論します。</p>
<h2 id="五英語版">五、英語版</h2>
<p><strong>1.1 製品とカテゴリの抽出</strong></p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>delimiter <span class="op">=</span> <span class="st">&quot;####&quot;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>system_message <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ss">You will be provided with customer service queries. </span><span class="ch">\</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ss">The customer service query will be delimited with </span><span class="ch">\</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>delimiter<span class="sc">}</span><span class="ss"> characters.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="ss">Output a Python list of objects, where each object has </span><span class="ch">\</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="ss">the following format:</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="ss">    &#39;category&#39;: &lt;one of Computers and Laptops, </span><span class="ch">\</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="ss">    Smartphones and Accessories, </span><span class="ch">\</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="ss">    Televisions and Home Theater Systems, </span><span class="ch">\</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="ss">    Gaming Consoles and Accessories, </span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="ss">    Audio Equipment, Cameras and Camcorders&gt;,</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="ss">and</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="ss">    &#39;products&#39;: &lt;products must be found in the customer service query. And products that must </span><span class="ch">\</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="ss">    be found in the allowed products below. If no products are found, output an empty list.</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="ss">    &gt;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="ss">Where the categories and products must be found in </span><span class="ch">\</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="ss">the customer service query.</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="ss">If a product is mentioned, it must be associated with </span><span class="ch">\</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="ss">the correct category in the allowed products list below.</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="ss">If no products or categories are found, output an </span><span class="ch">\</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="ss">empty list.</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="ss">Allowed products: </span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="ss">Products under Computers and Laptops category:</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="ss">TechPro Ultrabook</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="ss">BlueWave Gaming Laptop</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="ss">PowerLite Convertible</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="ss">TechPro Desktop</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="ss">BlueWave Chromebook</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="ss">Products under Smartphones and Accessories category:</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="ss">SmartX ProPhone</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="ss">MobiTech PowerCase</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="ss">SmartX MiniPhone</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="ss">MobiTech Wireless Charger</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="ss">SmartX EarBuds</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="ss">Products under Televisions and Home Theater Systems category:</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="ss">CineView 4K TV</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="ss">SoundMax Home Theater</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="ss">CineView 8K TV</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="ss">SoundMax Soundbar</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="ss">CineView OLED TV</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="ss">Products under Gaming Consoles and Accessories category:</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="ss">GameSphere X</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="ss">ProGamer Controller</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="ss">GameSphere Y</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="ss">ProGamer Racing Wheel</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="ss">GameSphere VR Headset</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="ss">Products under Audio Equipment category:</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="ss">AudioPhonic Noise-Canceling Headphones</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a><span class="ss">WaveSound Bluetooth Speaker</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="ss">AudioPhonic True Wireless Earbuds</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="ss">WaveSound Soundbar</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a><span class="ss">AudioPhonic Turntable</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="ss">Products under Cameras and Camcorders category:</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a><span class="ss">FotoSnap DSLR Camera</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="ss">ActionCam 4K</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a><span class="ss">FotoSnap Mirrorless Camera</span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a><span class="ss">ZoomMaster Camcorder</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a><span class="ss">FotoSnap Instant Camera</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a><span class="ss">Only output the list of objects, with nothing else.</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>user_message_1 <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a><span class="ss"> tell me about the smartx pro phone and </span><span class="ch">\</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a><span class="ss"> the fotosnap camera, the dslr one. </span><span class="ch">\</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a><span class="ss"> Also tell me about your tvs &quot;&quot;&quot;</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span>  [  </span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>{<span class="st">&#39;role&#39;</span>:<span class="st">&#39;system&#39;</span>, </span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;content&#39;</span>: system_message},    </span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>{<span class="st">&#39;role&#39;</span>:<span class="st">&#39;user&#39;</span>, </span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;content&#39;</span>: <span class="ss">f&quot;</span><span class="sc">{</span>delimiter<span class="sc">}{</span>user_message_1<span class="sc">}{</span>delimiter<span class="sc">}</span><span class="ss">&quot;</span>},  </span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>] </span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>category_and_product_response_1 <span class="op">=</span> get_completion_from_messages(messages)</span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>category_and_product_response_1</span></code></pre></div>
<pre><code>&quot;[{&#39;category&#39;: &#39;Smartphones and Accessories&#39;, &#39;products&#39;: [&#39;SmartX ProPhone&#39;]}, {&#39;category&#39;: &#39;Cameras and Camcorders&#39;, &#39;products&#39;: [&#39;FotoSnap DSLR Camera&#39;]}, {&#39;category&#39;: &#39;Televisions and Home Theater Systems&#39;, &#39;products&#39;: []}]&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>user_message_2 <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ss">my router isn&#39;t working&quot;&quot;&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span>  [  </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>{<span class="st">&#39;role&#39;</span>:<span class="st">&#39;system&#39;</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;content&#39;</span>: system_message},    </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>{<span class="st">&#39;role&#39;</span>:<span class="st">&#39;user&#39;</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;content&#39;</span>: <span class="ss">f&quot;</span><span class="sc">{</span>delimiter<span class="sc">}{</span>user_message_2<span class="sc">}{</span>delimiter<span class="sc">}</span><span class="ss">&quot;</span>},  </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>] </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> get_completion_from_messages(messages)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response)</span></code></pre></div>
<pre><code>[]</code></pre>
<p><strong>2.1 詳細情報の検索</strong></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;products.json&quot;</span>, <span class="st">&quot;r&quot;</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    products <span class="op">=</span> josn.load(<span class="bu">file</span>)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_product_by_name(name):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> products.get(name, <span class="va">None</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_products_by_category(category):</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [product <span class="cf">for</span> product <span class="kw">in</span> products.values() <span class="cf">if</span> product[<span class="st">&quot;category&quot;</span>] <span class="op">==</span> category]</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>get_product_by_name(<span class="st">&quot;TechPro Ultrabook&quot;</span>)</span></code></pre></div>
<pre><code>{&#39;name&#39;: &#39;TechPro Ultrabook&#39;,
 &#39;category&#39;: &#39;Computers and Laptops&#39;,
 &#39;brand&#39;: &#39;TechPro&#39;,
 &#39;model_number&#39;: &#39;TP-UB100&#39;,
 &#39;warranty&#39;: &#39;1 year&#39;,
 &#39;rating&#39;: 4.5,
 &#39;features&#39;: [&#39;13.3-inch display&#39;,
  &#39;8GB RAM&#39;,
  &#39;256GB SSD&#39;,
  &#39;Intel Core i5 processor&#39;],
 &#39;description&#39;: &#39;A sleek and lightweight ultrabook for everyday use.&#39;,
 &#39;price&#39;: 799.99}</code></pre>
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>get_products_by_category(<span class="st">&quot;Computers and Laptops&quot;</span>)</span></code></pre></div>
<pre><code>[{&#39;name&#39;: &#39;TechPro Ultrabook&#39;,
  &#39;category&#39;: &#39;Computers and Laptops&#39;,
  &#39;brand&#39;: &#39;TechPro&#39;,
  &#39;model_number&#39;: &#39;TP-UB100&#39;,
  &#39;warranty&#39;: &#39;1 year&#39;,
  &#39;rating&#39;: 4.5,
  &#39;features&#39;: [&#39;13.3-inch display&#39;,
   &#39;8GB RAM&#39;,
   &#39;256GB SSD&#39;,
   &#39;Intel Core i5 processor&#39;],
  &#39;description&#39;: &#39;A sleek and lightweight ultrabook for everyday use.&#39;,
  &#39;price&#39;: 799.99},
 {&#39;name&#39;: &#39;BlueWave Gaming Laptop&#39;,
  &#39;category&#39;: &#39;Computers and Laptops&#39;,
  &#39;brand&#39;: &#39;BlueWave&#39;,
  &#39;model_number&#39;: &#39;BW-GL200&#39;,
  &#39;warranty&#39;: &#39;2 years&#39;,
  &#39;rating&#39;: 4.7,
  &#39;features&#39;: [&#39;15.6-inch display&#39;,
   &#39;16GB RAM&#39;,
   &#39;512GB SSD&#39;,
   &#39;NVIDIA GeForce RTX 3060&#39;],
  &#39;description&#39;: &#39;A high-performance gaming laptop for an immersive experience.&#39;,
  &#39;price&#39;: 1199.99},
 {&#39;name&#39;: &#39;PowerLite Convertible&#39;,
  &#39;category&#39;: &#39;Computers and Laptops&#39;,
  &#39;brand&#39;: &#39;PowerLite&#39;,
  &#39;model_number&#39;: &#39;PL-CV300&#39;,
  &#39;warranty&#39;: &#39;1 year&#39;,
  &#39;rating&#39;: 4.3,
  &#39;features&#39;: [&#39;14-inch touchscreen&#39;,
   &#39;8GB RAM&#39;,
   &#39;256GB SSD&#39;,
   &#39;360-degree hinge&#39;],
  &#39;description&#39;: &#39;A versatile convertible laptop with a responsive touchscreen.&#39;,
  &#39;price&#39;: 699.99},
 {&#39;name&#39;: &#39;TechPro Desktop&#39;,
  &#39;category&#39;: &#39;Computers and Laptops&#39;,
  &#39;brand&#39;: &#39;TechPro&#39;,
  &#39;model_number&#39;: &#39;TP-DT500&#39;,
  &#39;warranty&#39;: &#39;1 year&#39;,
  &#39;rating&#39;: 4.4,
  &#39;features&#39;: [&#39;Intel Core i7 processor&#39;,
   &#39;16GB RAM&#39;,
   &#39;1TB HDD&#39;,
   &#39;NVIDIA GeForce GTX 1660&#39;],
  &#39;description&#39;: &#39;A powerful desktop computer for work and play.&#39;,
  &#39;price&#39;: 999.99},
 {&#39;name&#39;: &#39;BlueWave Chromebook&#39;,
  &#39;category&#39;: &#39;Computers and Laptops&#39;,
  &#39;brand&#39;: &#39;BlueWave&#39;,
  &#39;model_number&#39;: &#39;BW-CB100&#39;,
  &#39;warranty&#39;: &#39;1 year&#39;,
  &#39;rating&#39;: 4.1,
  &#39;features&#39;: [&#39;11.6-inch display&#39;, &#39;4GB RAM&#39;, &#39;32GB eMMC&#39;, &#39;Chrome OS&#39;],
  &#39;description&#39;: &#39;A compact and affordable Chromebook for everyday tasks.&#39;,
  &#39;price&#39;: 249.99}]</code></pre>
<p><strong>3.1 入力文字列の解析</strong></p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_string_to_list(input_string):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">    入力文字列をPythonリストに変換します。</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">    パラメータ:</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    input_string: 入力文字列、有効なJSON形式である必要があります。</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">    戻り値:</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">    list または None: 入力文字列が有効な場合は対応するPythonリストを返し、そうでなければNoneを返します。</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> input_string <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 入力文字列の単引用符を二重引用符に置き換えて、JSON形式の要件を満たす</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        input_string <span class="op">=</span> input_string.replace(<span class="st">&quot;&#39;&quot;</span>, <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&quot;</span>)  </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.loads(input_string)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> json.JSONDecodeError:</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Error: Invalid JSON string&quot;</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>   </span></code></pre></div>
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>category_and_product_list <span class="op">=</span> read_string_to_list(category_and_product_response_1)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>category_and_product_list</span></code></pre></div>
<pre><code>[{&#39;category&#39;: &#39;Smartphones and Accessories&#39;, &#39;products&#39;: [&#39;SmartX ProPhone&#39;]}, {&#39;category&#39;: &#39;Cameras and Camcorders&#39;, &#39;products&#39;: [&#39;FotoSnap DSLR Camera&#39;]}, {&#39;category&#39;: &#39;Televisions and Home Theater Systems&#39;, &#39;products&#39;: []}]</code></pre>
<p><strong>3.2 検索の実行</strong></p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_output_string(data_list):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">    入力データリストに基づいて製品またはカテゴリ情報を含む文字列を生成します。</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">    パラメータ:</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">    data_list: 辞書を含むリスト、各辞書は「products」または「category」のキーを含む必要があります。</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">    戻り値:</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">    output_string: 製品またはカテゴリ情報を含む文字列。</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    output_string <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data_list <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> output_string</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> data <span class="kw">in</span> data_list:</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">&quot;products&quot;</span> <span class="kw">in</span> data <span class="kw">and</span> data[<span class="st">&quot;products&quot;</span>]:</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                products_list <span class="op">=</span> data[<span class="st">&quot;products&quot;</span>]</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> product_name <span class="kw">in</span> products_list:</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                    product <span class="op">=</span> get_product_by_name(product_name)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> product:</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>                        output_string <span class="op">+=</span> json.dumps(product, indent<span class="op">=</span><span class="dv">4</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>) <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">print</span>(<span class="ss">f&quot;Error: Product &#39;</span><span class="sc">{</span>product_name<span class="sc">}</span><span class="ss">&#39; not found&quot;</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="st">&quot;category&quot;</span> <span class="kw">in</span> data:</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>                category_name <span class="op">=</span> data[<span class="st">&quot;category&quot;</span>]</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>                category_products <span class="op">=</span> get_products_by_category(category_name)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> product <span class="kw">in</span> category_products:</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>                    output_string <span class="op">+=</span> json.dumps(product, indent<span class="op">=</span><span class="dv">4</span>, ensure_ascii<span class="op">=</span><span class="va">False</span>) <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&quot;Error: Invalid object format&quot;</span>)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_string </span></code></pre></div>
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>product_information_for_user_message_1 <span class="op">=</span> generate_output_string(category_and_product_list)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(product_information_for_user_message_1)</span></code></pre></div>
<pre><code>{
    &quot;name&quot;: &quot;SmartX ProPhone&quot;,
    &quot;category&quot;: &quot;Smartphones and Accessories&quot;,
    &quot;brand&quot;: &quot;SmartX&quot;,
    &quot;model_number&quot;: &quot;SX-PP10&quot;,
    &quot;warranty&quot;: &quot;1 year&quot;,
    &quot;rating&quot;: 4.6,
    &quot;features&quot;: [
        &quot;6.1-inch display&quot;,
        &quot;128GB storage&quot;,
        &quot;12MP dual camera&quot;,
        &quot;5G&quot;
    ],
    &quot;description&quot;: &quot;A powerful smartphone with advanced camera features.&quot;,
    &quot;price&quot;: 899.99
}
{
    &quot;name&quot;: &quot;FotoSnap DSLR Camera&quot;,
    &quot;category&quot;: &quot;Cameras and Camcorders&quot;,
    &quot;brand&quot;: &quot;FotoSnap&quot;,
    &quot;model_number&quot;: &quot;FS-DSLR200&quot;,
    &quot;warranty&quot;: &quot;1 year&quot;,
    &quot;rating&quot;: 4.7,
    &quot;features&quot;: [
        &quot;24.2MP sensor&quot;,
        &quot;1080p video&quot;,
        &quot;3-inch LCD&quot;,
        &quot;Interchangeable lenses&quot;
    ],
    &quot;description&quot;: &quot;Capture stunning photos and videos with this versatile DSLR camera.&quot;,
    &quot;price&quot;: 599.99
}
{
    &quot;name&quot;: &quot;CineView 4K TV&quot;,
    &quot;category&quot;: &quot;Televisions and Home Theater Systems&quot;,
    &quot;brand&quot;: &quot;CineView&quot;,
    &quot;model_number&quot;: &quot;CV-4K55&quot;,
    &quot;warranty&quot;: &quot;2 years&quot;,
    &quot;rating&quot;: 4.8,
    &quot;features&quot;: [
        &quot;55-inch display&quot;,
        &quot;4K resolution&quot;,
        &quot;HDR&quot;,
        &quot;Smart TV&quot;
    ],
    &quot;description&quot;: &quot;A stunning 4K TV with vibrant colors and smart features.&quot;,
    &quot;price&quot;: 599.99
}
{
    &quot;name&quot;: &quot;SoundMax Home Theater&quot;,
    &quot;category&quot;: &quot;Televisions and Home Theater Systems&quot;,
    &quot;brand&quot;: &quot;SoundMax&quot;,
    &quot;model_number&quot;: &quot;SM-HT100&quot;,
    &quot;warranty&quot;: &quot;1 year&quot;,
    &quot;rating&quot;: 4.4,
    &quot;features&quot;: [
        &quot;5.1 channel&quot;,
        &quot;1000W output&quot;,
        &quot;Wireless subwoofer&quot;,
        &quot;Bluetooth&quot;
    ],
    &quot;description&quot;: &quot;A powerful home theater system for an immersive audio experience.&quot;,
    &quot;price&quot;: 399.99
}
{
    &quot;name&quot;: &quot;CineView 8K TV&quot;,
    &quot;category&quot;: &quot;Televisions and Home Theater Systems&quot;,
    &quot;brand&quot;: &quot;CineView&quot;,
    &quot;model_number&quot;: &quot;CV-8K65&quot;,
    &quot;warranty&quot;: &quot;2 years&quot;,
    &quot;rating&quot;: 4.9,
    &quot;features&quot;: [
        &quot;65-inch display&quot;,
        &quot;8K resolution&quot;,
        &quot;HDR&quot;,
        &quot;Smart TV&quot;
    ],
    &quot;description&quot;: &quot;Experience the future of television with this stunning 8K TV.&quot;,
    &quot;price&quot;: 2999.99
}
{
    &quot;name&quot;: &quot;SoundMax Soundbar&quot;,
    &quot;category&quot;: &quot;Televisions and Home Theater Systems&quot;,
    &quot;brand&quot;: &quot;SoundMax&quot;,
    &quot;model_number&quot;: &quot;SM-SB50&quot;,
    &quot;warranty&quot;: &quot;1 year&quot;,
    &quot;rating&quot;: 4.3,
    &quot;features&quot;: [
        &quot;2.1 channel&quot;,
        &quot;300W output&quot;,
        &quot;Wireless subwoofer&quot;,
        &quot;Bluetooth&quot;
    ],
    &quot;description&quot;: &quot;Upgrade your TV&#39;s audio with this sleek and powerful soundbar.&quot;,
    &quot;price&quot;: 199.99
}
{
    &quot;name&quot;: &quot;CineView OLED TV&quot;,
    &quot;category&quot;: &quot;Televisions and Home Theater Systems&quot;,
    &quot;brand&quot;: &quot;CineView&quot;,
    &quot;model_number&quot;: &quot;CV-OLED55&quot;,
    &quot;warranty&quot;: &quot;2 years&quot;,
    &quot;rating&quot;: 4.7,
    &quot;features&quot;: [
        &quot;55-inch display&quot;,
        &quot;4K resolution&quot;,
        &quot;HDR&quot;,
        &quot;Smart TV&quot;
    ],
    &quot;description&quot;: &quot;Experience true blacks and vibrant colors with this OLED TV.&quot;,
    &quot;price&quot;: 1499.99
}</code></pre>
<p><strong>3.3 ユーザークエリの回答生成</strong></p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>system_message <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ss">You are a customer service assistant for a </span><span class="ch">\</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="ss">large electronic store. </span><span class="ch">\</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="ss">Respond in a friendly and helpful tone, </span><span class="ch">\</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="ss">with very concise answers. </span><span class="ch">\</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="ss">Make sure to ask the user relevant follow up questions.</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="ss">&quot;&quot;&quot;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>user_message_1 <span class="op">=</span> <span class="ss">f&quot;&quot;&quot;</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="ss">tell me about the smartx pro phone and </span><span class="ch">\</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="ss">the fotosnap camera, the dslr one. </span><span class="ch">\</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="ss">Also tell me about your tvs&quot;&quot;&quot;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span>  [{<span class="st">&#39;role&#39;</span>:<span class="st">&#39;system&#39;</span>,<span class="st">&#39;content&#39;</span>: system_message},   </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>             {<span class="st">&#39;role&#39;</span>:<span class="st">&#39;user&#39;</span>,<span class="st">&#39;content&#39;</span>: user_message_1},</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>             {<span class="st">&#39;role&#39;</span>:<span class="st">&#39;assistant&#39;</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;content&#39;</span>: <span class="ss">f&quot;&quot;&quot;Relevant product information:</span><span class="ch">\n\</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="ss">              </span><span class="sc">{</span>product_information_for_user_message_1<span class="sc">}</span><span class="ss">&quot;&quot;&quot;</span>}]</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>final_response <span class="op">=</span> get_completion_from_messages(messages)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(final_response)</span></code></pre></div>
<pre><code>The SmartX ProPhone is a powerful smartphone with a 6.1-inch display, 128GB storage, a 12MP dual camera, and 5G capability. It is priced at $899.99 and comes with a 1-year warranty. 

The FotoSnap DSLR Camera is a versatile camera with a 24.2MP sensor, 1080p video recording, a 3-inch LCD screen, and interchangeable lenses. It is priced at $599.99 and also comes with a 1-year warranty.

As for our TVs, we have a range of options. The CineView 4K TV is a 55-inch TV with 4K resolution, HDR, and smart TV features. It is priced at $599.99 and comes with a 2-year warranty.

We also have the CineView 8K TV, which is a 65-inch TV with 8K resolution, HDR, and smart TV features. It is priced at $2999.99 and also comes with a 2-year warranty.

Lastly, we have the CineView OLED TV, which is a 55-inch TV with 4K resolution, HDR, and smart TV features. It is priced at $1499.99 and comes with a 2-year warranty.

Is there anything specific you would like to know about these products?</code></pre>
</body>
</html>
